// P2P Host Node Configuration

// Node identity and basic settings
node: {
    // Node identification
    id: ""  // Will be assigned by coordinator
    name: "P2P-Host"
    type: "auto"  // "main_server", "player_host", or "auto" for dynamic role
    
    // Role settings
    role: {
        can_be_main: true  // Can this node act as main server
        can_be_player_host: true  // Can this node act as player host
        preferred_role: "auto"  // Preferred role if multiple roles possible
        max_hosted_maps: 5  // Maximum number of maps this node can host
    }
    
    // Network settings
    network: {
        bind_ip: "0.0.0.0"
        port: 0  // Will be assigned by coordinator
        public_ip: ""  // Leave empty for auto-detection
        coordinator_address: "coordinator.example.com"
        coordinator_port: 5121
    }
    
    // Performance settings
    performance: {
        max_maps: 5
        max_players_per_map: 100
        total_max_players: 300
        update_interval: 50  // ms
    }
}

// Resource management
resources: {
    // CPU settings
    cpu: {
        max_usage: 80  // percentage
        reserved_cores: 1
        min_free_cpu: 20  // percentage
        process_priority: "normal"  // low, normal, high
        metrics: {
            collect_model_info: true
            collect_frequency: true
            collect_cache_info: true
            collect_load_avg: true
            benchmark_interval: 3600  // seconds
        }
    }
    
    // Memory settings
    memory: {
        max_usage: 85  // percentage
        min_free: 512  // MB
        min_available: 1024  // MB
        swap_threshold: 90  // percentage
        pressure_monitoring: true
        metrics: {
            collect_detailed_stats: true
            monitor_pressure: true
            track_page_faults: true
            track_cached_ram: true
        }
    }
    
    // Network settings
    network: {
        max_bandwidth: 100  // Mbps
        buffer_size: 65536
        max_connections: 1000
        quality_monitoring: {
            enabled: true
            measure_upload_speed: true
            measure_download_speed: true
            measure_latency: true
            measure_jitter: true
            measure_packet_loss: true
            test_interval: 300  // seconds
            test_duration: 10   // seconds
        }
    }
}

// State management
state: {
    // State synchronization
    sync: {
        enabled: true
        interval: 5000  // ms
        verify_consistency: true
        full_sync_interval: 60000  // ms
    }
    
    // State backup
    backup: {
        enabled: true
        interval: 300  // seconds
        keep_versions: 3
        compression: true
        verify_backup: true
    }
    
    // State transfer
    transfer: {
        chunk_size: 1048576  // 1MB
        parallel_transfers: 2
        compression: true
        verify_transfer: true
    }
}

// Failover handling
failover: {
    // Role transition
    transition: {
        enabled: true
        allow_main_server_role: true
        allow_player_host_role: true
        transition_timeout: 30  // seconds
    }
    
    // State preservation
    state: {
        save_interval: 5000  // ms
        verify_state: true
        max_state_age: 60  // seconds
        require_consistency: true
    }
    
    // Recovery
    recovery: {
        auto_recover: true
        max_attempts: 3
        backoff_interval: 5000  // ms
        verify_recovery: true
    }
}

// Monitoring and metrics
monitoring: {
    // System metrics
    system_metrics: {
        enabled: true
        collection_interval: 5000  // ms
        report_interval: 30000  // ms
        detailed_logging: true
        collectors: {
            hardware_info: true
            performance_stats: true
            network_stats: true
            state_metrics: true
        }
    }
    
    // Role monitoring
    role_metrics: {
        track_transitions: true
        log_state_changes: true
        measure_availability: true
        record_hosting_stats: true
    }
    
    // Health checks
    health: {
        enabled: true
        check_interval: 5000  // ms
        failure_threshold: 3
        success_threshold: 2
        timeout: 1000  // ms
    }
}

// Security settings
security: {
    // Encryption
    encryption: {
        enabled: true
        method: "AES-256-GCM"
        key_rotation: true
        rotation_interval: 3600  // seconds
    }
    
    // Authentication
    auth: {
        require_auth: true
        token_validity: 3600  // seconds
        verify_peers: true
        secure_state_transfer: true
    }
}

// Debug settings
debug: {
    // Logging
    logging: {
        level: "info"  // debug, info, warn, error
        file: "log/p2p_host.log"
        max_size: 100  // MB
        max_files: 10
        log_transitions: true
    }
    
    // Development
    development: {
        local_mode: false
        mock_coordinator: false
        simulate_failures: false
    }
}