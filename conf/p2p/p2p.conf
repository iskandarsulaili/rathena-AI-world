// P2P Hosting Configuration

// Core settings
p2p: {
    // Enable P2P hosting system
    enabled: true
    
    // Coordinator server settings
    coordinator: {
        port: 5121
        max_connections: 1000
        update_interval: 100  // ms
        bind_ip: "0.0.0.0"
    }
    
    // Database proxy settings
    database: {
        port: 5122
        max_connections: 500
        cache_duration: 300  // seconds
        sync_interval: 5000  // ms
    }
}

// Host selection settings
host_selection: {
    // Host eligibility criteria
    requirements: {
        min_cpu_cores: 2
        min_cpu_frequency_mhz: 2000
        min_single_thread_score: 1500  // CPU benchmark score
        min_memory_mb: 2048
        min_free_memory_mb: 1024
        min_upload_mbps: 5
        min_download_mbps: 10
        max_latency_ms: 200
        max_jitter_ms: 50
        min_uptime_hours: 1
        min_storage_gb: 20
        min_free_storage_gb: 5
        
        // Stability requirements
        max_packet_loss_percent: 1.0
        min_stability_score: 0.95  // Based on historical uptime and performance
        max_cpu_load_avg: 80
        
        // Hardware requirements
        required_cpu_features: [
            "SSE4.2",
            "AVX2"
        ]
        virtualization_allowed: false  // Must be bare metal
        
        // Geographic requirements
        geo_location: {
            enabled: true
            max_distance_km: 1000  // Max distance from players
            preferred_regions: ["asia", "sea"]  // Preferred hosting regions
        }
        
        // Stability history
        stability_history: {
            min_days_history: 7
            min_successful_sessions: 50
            max_failures_per_day: 2
            recovery_time_minutes: 5
        }
    }
    
    // Selection weights
    weights: {
        performance_score: 0.4
        latency: 0.3
        reliability: 0.2
        capacity: 0.1
        stability_history: 0.2
        network_quality: 0.3
    }
    
    // Performance thresholds
    thresholds: {
        cpu_usage: 80
        memory_usage: 85
        memory_pressure: 70
        network_usage: 90
        io_pressure: 80
        connection_count: 1000
        bandwidth_usage: 75
        disk_io_usage: 70
        thread_usage: 85
        error_rate: 5
    }
    
    // Security compliance
    security_requirements: {
        encryption_required: true
        firewall_required: true
        ddos_protection: true
        secure_boot: true
        updated_os: true
        antivirus_required: true
    }
    
    // Performance validation
    performance_validation: {
        enabled: true
        test_duration_minutes: 10
        tests: {
            stress_test: true
            network_flood_test: true
            concurrent_players_test: true
            map_loading_test: true
        }
    }
}

// Map distribution settings
map_distribution: {
    // Map categorization
    critical_maps: [
        "prontera",
        "geffen",
        "payon",
        "alberta",
        "morocc"
    ]
    
    // Distribution rules
    rules: {
        max_maps_per_host: 5
        max_players_per_host: 100
        backup_host_count: 2
        load_balance_threshold: 0.8
    }
    
    // VPS failover settings
    vps_failover: {
        enabled: true
        priority_maps: [
            "guild_vs1",
            "guild_vs2",
            "pvp_room"
        ]
        auto_failover: true
    }
}

// Synchronization settings
synchronization: {
    // Update intervals
    intervals: {
        position: 50     // ms
        status: 100      // ms
        entity: 200      // ms
        chat: 0         // instant
        trade: 0        // instant
    }
    
    // Batch processing
    batching: {
        enabled: true
        max_batch_size: 100
        max_delay_ms: 50
    }
    
    // State verification
    verification: {
        enabled: true
        check_interval: 5000  // ms
        tolerance: 100       // ms
    }
}

// Security settings
security: {
    // Encryption
    encryption: {
        enabled: true
        algorithm: "AES-256-GCM"
        key_rotation_interval: 3600  // seconds
    }
    
    // Authentication
    auth: {
        token_validity: 3600  // seconds
        max_failed_attempts: 5
        lockout_duration: 900  // seconds
    }
    
    // Rate limiting
    rate_limits: {
        new_connections: {
            window: 60     // seconds
            max_attempts: 5
        }
        packets: {
            window: 1      // second
            max_packets: 100
        }
    }
}

// Performance monitoring
monitoring: {
    // Metrics collection
    metrics: {
        enabled: true
        collection_interval: 5000  // ms
        retention_days: 30
    }
    
    // Alerts
    alerts: {
        enabled: true
        channels: ["email", "discord"]
        cooldown: 300  // seconds
    }
    
    // Health checks
    health_checks: {
        enabled: true
        interval: 30000  // ms
        timeout: 5000   // ms
    }
}

// Failover handling
failover: {
    // Detection
    detection: {
        ping_timeout: 5000     // ms
        max_retries: 3
        check_interval: 1000   // ms
    }
    
    // Recovery
    recovery: {
        auto_recover: true
        recovery_delay: 30000  // ms
        max_attempts: 3
    }
    
    // State handling
    state: {
        save_interval: 60000   // ms
        backup_enabled: true
        state_sync_timeout: 5000  // ms
    }
}

// Resource management
resources: {
    // Memory limits
    memory: {
        map_cache_size: 256    // MB
        entity_cache_size: 128  // MB
        packet_buffer_size: 64  // MB
    }
    
    // Thread pools
    threads: {
        network_threads: 4
        worker_threads: 8
        async_tasks: 4
    }
    
    // File handles
    files: {
        max_open_files: 1024
        max_map_files: 100
    }
}

// Network optimization
network: {
    // TCP settings
    tcp: {
        keepalive: true
        nodelay: true
        send_buffer: 65536
        recv_buffer: 65536
    }
    
    // WebSocket settings
    websocket: {
        enabled: true
        compression: true
        max_payload: 65536
    }
    
    // Protocol
    protocol: {
        version: 1
        compatibility: true
        packet_version: 1
    }
}

// Logging configuration
logging: {
    // Log levels
    levels: {
        network: "info"
        security: "info"
        performance: "info"
        synchronization: "info"
        failover: "debug"
    }
    
    // File rotation
    rotation: {
        max_size: 100     // MB
        max_files: 10
        compress: true
    }
    
    // Audit logging
    audit: {
        enabled: true
        retention_days: 90
    }
}